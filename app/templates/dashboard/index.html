{% extends "base.html" %}
{% block title %}Dashboard – DNS Watcher{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="bi bi-speedometer2 me-2"></i>Dashboard</h2>
</div>

<!-- Summary cards -->
<div class="row g-3 mb-4">
  {% set card_defs = [
    ('ok',       'success', 'check-circle',    'OK'),
    ('warning',  'warning', 'exclamation-triangle', 'Warning'),
    ('critical', 'danger',  'x-circle',        'Critical'),
    ('pending',  'secondary','hourglass-split', 'Pending'),
  ] %}
  {% for key, color, icon, label in card_defs %}
  <div class="col-6 col-md-3">
    <div class="card text-bg-{{ color }} border-0 shadow-sm">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="fs-2 fw-bold">{{ status_counts.get(key, 0) }}</div>
          <div class="small">{{ label }}</div>
        </div>
        <i class="bi bi-{{ icon }} fs-1 opacity-50"></i>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Domain table -->
<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span><i class="bi bi-list-ul me-1"></i>Monitored Domains ({{ domains|length }})</span>
  </div>
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Hostname</th>
          <th>Status</th>
          <th>SPF</th>
          <th>DMARC</th>
          <th>DKIM</th>
          <th>Reputation</th>
          <th>Last Checked</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% if domains %}
          {% for domain in domains %}
          <tr>
            <td class="fw-semibold">{{ domain.hostname }}</td>
            <td>
              {% set s = domain.current_status %}
              {% if s == 'ok' %}
                <span class="badge bg-success">OK</span>
              {% elif s == 'warning' %}
                <span class="badge bg-warning text-dark">Warning</span>
              {% elif s == 'critical' %}
                <span class="badge bg-danger">Critical</span>
              {% else %}
                <span class="badge bg-secondary">{{ s|title }}</span>
              {% endif %}
            </td>
            <td><span class="badge bg-secondary">–</span></td>
            <td><span class="badge bg-secondary">–</span></td>
            <td><span class="badge bg-secondary">–</span></td>
            <td><span class="badge bg-secondary">–</span></td>
            <td class="text-muted small">
              {% if domain.last_checked_at %}
                {{ domain.last_checked_at.strftime('%Y-%m-%d %H:%M') }}
              {% else %}
                Never
              {% endif %}
            </td>
            <td>
              <a href="#" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-arrow-repeat"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="8" class="text-center text-muted py-4">
              No domains configured yet. Go to <a href="{{ url_for('settings.index') }}">Settings</a> to add one.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
