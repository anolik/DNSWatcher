[build]
builder = "nixpacks"
nixpacksConfigPath = "nixpacks.toml"

[deploy]
startCommand = "python init_db.py && python migrate_add_tls.py; python migrate_add_feature_toggles.py; python migrate_add_retention.py; python migrate_add_dmarc_policy.py; python migrate_add_user_fields.py; python migrate_add_multitenancy.py; python migrate_add_outbound_email.py; python migrate_fix_null_org_reports.py; python migrate_add_rdap_servers.py; python migrate_add_rdap_throttle.py; python create_admin.py --username $ADMIN_USER --password $ADMIN_PASS || true; gunicorn wsgi:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5
